{
   "accelerator": {
      "name": "v4-8",
      "numCores": 4,
      "replicas": 1,
      "size": 8,
      "type": "tpu",
      "variant": "",
      "version": 4
   },
   "command": [
      "/bin/bash",
      "-c",
      "set -u\nset -e\nset -x\n\ncd /tmp\ngit clone https://github.com/huggingface/transformers.git\ncd transformers\npip install .\npip install -r examples/tensorflow/_tests_requirements.txt\n\ncd /tmp/transformers/examples/tensorflow/translation\npip install -r requirements.txt\nmkdir /tmp/t5-translation\npython3 run_translation.py \\\n  --model_name_or_path t5-small \\\n  --do_train \\\n  --do_eval \\\n  --max_train_samples 10000 \\\n  --max_eval_samples 1000 \\\n  --num_train_epochs 1 \\\n  --num_beams 1 \\\n  --source_lang en \\\n  --target_lang ro \\\n  --source_prefix \"translate English to Romanian: \" \\\n  --dataset_name wmt16 \\\n  --dataset_config_name ro-en \\\n  --output_dir /tmp/t5-translation \\\n  --per_device_train_batch_size=64 \\\n  --per_device_eval_batch_size=64\n\n"
   ],
   "configMaps": [
      "gcs-buckets"
   ],
   "cpu": 1,
   "entrypoint": null,
   "frameworkPrefix": "tf.exp",
   "image": "gcr.io/xl-ml-test/tensorflow",
   "imageTag": "nightly",
   "labels": {
      "accelerator": "v4-8",
      "benchmarkId": "tf.exp-t5-wmt16-func-v4-8-1vm",
      "frameworkVersion": "tf.exp",
      "mode": "func",
      "model": "t5-wmt16"
   },
   "memory": "2Gi",
   "metricConfig": {
      "sources": [
         {
            "tensorboard": {
               "aggregate_assertions": [
                  {
                     "assertion": {
                        "inclusive_bounds": true,
                        "std_devs_from_mean": {
                           "comparison": "GREATER",
                           "std_devs": 4
                        },
                        "wait_for_n_data_points": 0
                     },
                     "strategy": "AVERAGE",
                     "tag": "examples_per_second"
                  }
               ],
               "exclude_tags": [ ],
               "include_tags": [
                  {
                     "strategies": [
                        "FINAL"
                     ],
                     "tag_pattern": "*"
                  }
               ],
               "merge_runs": false
            }
         }
      ]
   },
   "mode": "func",
   "modelName": "t5-wmt16",
   "outputBucket": "$(OUTPUT_BUCKET)",
   "schedule": "0 9 * * *",
   "script": {
      "initialSetup": "cd /tmp\ngit clone https://github.com/huggingface/transformers.git\ncd transformers\npip install .\npip install -r examples/tensorflow/_tests_requirements.txt\n"
   },
   "testName": "tf.exp-t5-wmt16-func-v4-8-1vm",
   "timeout": 3600,
   "tpuSettings": {
      "preemptible": true,
      "requireTpuAvailableLabel": true,
      "reserved": "false",
      "softwareVersion": "v2-nightly",
      "tpuVmCreateSleepSeconds": 90,
      "tpuVmDockerArgs": "",
      "tpuVmEnvVars": {
         "PYTHONPATH": "${PWD}"
      },
      "tpuVmStartupScript": "echo Running startup script"
   },
   "volumeMap": {
      "dshm": {
         "claim": {
            "emptyDir": {
               "medium": "Memory"
            }
         },
         "mountPath": "/dev/shm",
         "name": "dshm",
         "readOnly": false
      },
      "scripts": {
         "claim": {
            "emptyDir": {
               "medium": "Memory"
            }
         },
         "mountPath": "/scripts",
         "name": "scripts",
         "readOnly": false
      }
   }
}
